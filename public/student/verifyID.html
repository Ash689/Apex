<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student | Verify</title>
    <link rel="stylesheet" href="/static/standardStyle.css">
    <link rel="stylesheet" href="/static/formStyle.css">
</head>
<body>
    <div style = "top: 2%; z-index: 1;" class="header">
        <h1><a href="/welcome.html">Apex Tuition</a></h1>
    </div>
    <button id="logout-button" class="logout-button" style="z-index: 2; top: 2%;">Logout</button>
    <div id="message" class="message" style="z-index: 2;"></div>
    <div class="container">
        <div id="parent-form-container">
            <h2>Upload Documents</h2>
            <h3 id = "upload-notice">Now to upload ID</h3>
            <button id="id-button">Upload</button>
        </div>
    </div>

    <br><br><br><br><br>

    <div id="footer" class="footer"></div>
    
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="/script/standardScript.js"></script>
    <script src = "/script/validateDescription.js"></script>
    <script src="/script/validateID.js"></script>

    <script>

        fetch('/student/getVerifyID')
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                messageElement.textContent = data.error;
                messageElement.classList.add('error');
            } else {
                if (data.isIDVerified){
                    let form_container = document.getElementById('parent-form-container');
                    form_container.innerHTML = `
                        <h2>Upload Documents</h2>
                        <h3>ID Verified!</h3>
                        <button id="id-button" class = "secondary-button">Re-Upload Images</button>
                        <form id="subjectForm" action="/student/configSubject.html" method="GET">
                            <button type="submit">Continue</button>
                        </form>
                    
                    `;
                } else if (data.id_file){
                    let upload_sign = document.getElementById('upload-notice');
                    upload_sign.textContent = "Thank you for your documents. Awaiting verification."
                    let id_button = document.getElementById('id-button');
                    id_button.textContent = "Upload Files Again";
                }
                document.getElementById('id-button').addEventListener('click', function() {
                    let form_container = document.getElementById('parent-form-container');
                    form_container.innerHTML = `
                    
                        <form id="subjectForm" action="/student/sendID" method="post" enctype="multipart/form-data">
                            <h3 id = "id_header">Please upload ID: </h3>
                            <span id = "info-button" class="info-button">ℹ️</span>
                            ${data.id_file ? 
                                `<a href = /uploads/profileFiles/student/id/${data.id_file}>Download Sent ID</a>`
                            : ''}
                            <input type="file" id = "id-upload" name="document">
                            <p>Describe file:</p>
                            <input name="description" id = "description" class="notesContainerInput" maxlength = "50" autocomplete ="off" required>
                            <div class="submit-button-container">
                                <button type="submit" id = "submit" class = "disabled-button" disabled>Enter</button>
                            </div>
                        </form>
                    `;

                    validateID();

                            
                    document.getElementById('info-button').title = "Valid documents include driving license, passport, NINO letter";
                    

                    let id_header = document.getElementById('id_header');
                    id_header.textContent += `${data.email}`;

                    const idTypes = [
                        "Passport", 
                        "Driving Licence", 
                        "Biometric Residence Card", 
                        "National Identity Card", 
                        "Travel Document", 
                        "Birth/Adoption certificate", 
                    ];

                    $(function() {

                        $("#description").autocomplete({
                            source: idTypes,
                            minLength: 0,
                            select: function(event, ui) {
                                $("#description").val(ui.item.value);
                                return false;
                            }
                        }).focus(function() {
                            $(this).autocomplete("search", "");
                        });

                    });
                    
                });
            }
        })
        .catch(error => {
            console.error('Error:', error);
            window.location.href = `/student/login.html?message=Please log in .&type=error`;
        });
    </script>
    <script src="/script/student/logout.js"></script>

</body>
</html>
